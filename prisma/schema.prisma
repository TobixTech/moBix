generator client {
  provider = "prisma-client-js"
  binaryTargets = ["native", "rhel-openssl-3.0.x"]
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// User Model (To store app-specific data linked to Clerk)
model User {
  id        String   @id @default(uuid())
  clerkId   String   @unique
  email     String   @unique
  role      String   @default("USER") // Changed from enum to String to match DB
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  likes     Like[]
  comments  Comment[]
}

// User Roles
enum Role {
  USER
  ADMIN
}

// Movie Model (For all movie data)
model Movie {
  id            String    @id @default(uuid())
  title         String
  description   String
  year          Int
  genre         String
  posterUrl     String
  videoUrl      String
  customVastUrl String?   // Optional custom VAST URL per movie
  useGlobalAd   Boolean   @default(true)  // Toggle for global vs custom ad
  downloadUrl   String?   // Optional download link
  downloadEnabled Boolean @default(false)  // Toggle for download button
  isTrending    Boolean   @default(false)
  isFeatured    Boolean   @default(false)
  views         Int       @default(0)
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
  likes         Like[]
  comments      Comment[]
}

// Like Model (User likes for movies)
model Like {
  id        String   @id @default(uuid())
  userId    String
  movieId   String
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  movie     Movie    @relation(fields: [movieId], references: [id], onDelete: Cascade)
  createdAt DateTime @default(now())

  @@unique([userId, movieId])
}

// Comment Model (User comments and ratings)
model Comment {
  id        String   @id @default(uuid())
  userId    String
  movieId   String
  text      String
  rating    Int      @default(0)
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  movie     Movie    @relation(fields: [movieId], references: [id], onDelete: Cascade)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

// Admin Invite Code (For secure admin sign-up)
model AdminInvite {
  id        String    @id @default(uuid())
  code      String    @unique
  isValid   Boolean   @default(true)
  expiresAt DateTime?
  createdAt DateTime  @default(now())
}

// Ad Settings Model
model AdSettings {
  id                 String   @id @default(uuid())
  horizontalAdCode   String?
  verticalAdCode     String?
  vastPrerollUrl     String?  // Added VAST URL for pre-roll ads
  adTimeout          Int      @default(20)  // Ad timeout in seconds
  adsEnabled         Boolean  @default(true)  // Global ad toggle
  homepageEnabled    Boolean  @default(true)
  movieDetailEnabled Boolean  @default(true)
  dashboardEnabled   Boolean  @default(true)
  createdAt          DateTime @default(now())
  updatedAt          DateTime @updatedAt
}
